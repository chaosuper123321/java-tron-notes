## Module: ArchiveManifest.java
模块：ArchiveManifest.java

主要目标：重写leveldb清单的辅助功能。

关键功能：创建LevelDB选项，执行归档操作，检查清单，检查引擎。

关键变量：srcDbPath，name，options，startTime，CPUS，dbOptions，maxManifestSize，maxBatchSize，parameters，dbDirectory，files，res，executor，fails，currentFile，currentName，current，maxSize，levelDbFile，enginePath，engine。

相互依赖：与文件系统交互，与LevelDB引擎交互。

核心与辅助操作：主要操作包括创建LevelDB选项，执行归档操作，检查清单和引擎；辅助操作包括读写属性，打开数据库。

操作顺序：首先解析命令行参数，检查数据库目录，遍历文件列表，创建线程池并执行归档操作，检查清单和引擎，打开数据库，完成归档操作。

性能方面：考虑了线程池的使用和数据库操作的性能。

可重用性：模块中的方法和功能可以根据需要进行适当的调整和重用。

用法：通过运行main方法来执行归档操作，可以根据命令行参数配置数据库目录和批处理大小等参数。

假设：假设数据库目录存在，并且清单和引擎的检查是必要的。
## Flow Diagram [via mermaid]
```mermaid
flowchart TD
    A[ArchiveManifest.java] -->|imports| B[org.tron.plugins]
    A -->|imports| C[java.nio.charset.StandardCharsets.UTF_8]
    A -->|imports| D[org.iq80.leveldb.impl.Iq80DBFactory.factory]
    A -->|imports| E[java.io.BufferedInputStream]
    A -->|imports| F[java.io.BufferedReader]
    A -->|imports| G[java.io.BufferedWriter]
    A -->|imports| H[java.io.File]
    A -->|imports| I[java.io.FileInputStream]
    A -->|imports| J[java.io.FileOutputStream]
    A -->|imports| K[java.io.InputStream]
    A -->|imports| L[java.io.InputStreamReader]
    A -->|imports| M[java.io.OutputStream]
    A -->|imports| N[java.io.OutputStreamWriter]
    A -->|imports| O[java.nio.charset.StandardCharsets]
    A -->|imports| P[java.nio.file.Path]
    A -->|imports| Q[java.nio.file.Paths]
    A -->|imports| R[java.util.ArrayList]
    A -->|imports| S[java.util.Arrays]
    A -->|imports| T[java.util.List]
    A -->|imports| U[java.util.Objects]
    A -->|imports| V[java.util.Properties]
    A -->|imports| W[java.util.concurrent.ArrayBlockingQueue]
    A -->|imports| X[java.util.concurrent.Callable]
    A -->|imports| Y[java.util.concurrent.ExecutionException]
    A -->|imports| Z[java.util.concurrent.Executors]
    A -->|imports| AA[java.util.concurrent.Future]
    A -->|imports| AB[java.util.concurrent.ThreadPoolExecutor]
    A -->|imports| AC[java.util.concurrent.TimeUnit]
    A -->|imports| AD[java.util.stream.Collectors]
    A -->|imports| AE[lombok.extern.slf4j]
    A -->|imports| AF[org.iq80.leveldb.CompressionType]
    A -->|imports| AG[org.iq80.leveldb.DB]
    A -->|imports| AH[org.iq80.leveldb.Options]
    A -->|imports| AI[org.iq80.leveldb.impl.Filename]
    A -->|imports| AJ[picocli.CommandLine]
    A -->|imports| AK[picocli.CommandLine.Option]
    A -->|imports| AL[org.tron.plugins.ArchiveManifest]
    A -->|imports| AM[org.tron.plugins.ArchiveManifest.Args]

    AL -->|implements| AN[Callable<Boolean>]
    AL -->|has| AO[Path]
    AL -->|has| AP[String]
    AL -->|has| AQ[Options]
    AL -->|has| AR[long]
    AL -->|has| AS[int]
    AL -->|has| AT[CPUS]
    AL -->|has| AU[ArchiveManifest]
    AL -->|has| AV[Args]

    AV -->|has| AW[String]
    AV -->|has| AX[int]
    AV -->|has| AY[int]
    AV -->|has| AZ[boolean]

    AL -->|calls| BA[newDefaultLevelDbOptions]
    AL -->|calls| BB[run]
    AL -->|calls| BC[open]
    AL -->|calls| BD[checkManifest]
    AL -->|calls| BE[doArchive]
    AL -->|calls| BF[checkEngine]
    AL -->|calls| BG[readProperty]
    AL -->|calls| BH[writeProperty]

    BA -->|returns| BI[Options]

    BB -->|returns| BJ[int]

    BC -->|opens| BK[DB]
    BC -->|closes| BL[database]

    BD -->|reads| BM[File]
    BD -->|checks| BN[String]
    BD -->|checks| BO[String]
    BD -->|checks| BP[long]
    BD -->|logs| BQ[logger]
    BD -->|logs| BR[logger]
    BD -->|logs| BS[logger]
    BD -->|logs| BT[logger]
    BD -->|logs| BU[logger]
    BD -->|logs| BV[logger]
    BD -->|logs| BW[logger]
    BD -->|logs| BX[logger]

    BE -->|checks| BY[File]
    BE -->|checks| BZ[String]
    BE -->|opens| CA[]
    BE -->|logs| CB[logger]

    BF -->|reads| CC[String]
    BF -->|returns| CD[String]

    BH -->|writes| CE[boolean]

    AV -->|has| CF[File]
    AV -->|has| CG[File]
    AV -->|has| CH[List<File>]
    AV -->|has| CI[long]
    AV -->|has| CJ[List<Future<Boolean>>]
    AV -->|has| CK[ThreadPoolExecutor]
    AV -->|has| CL[int]
    AV -->|has| CM[Future<Boolean>]

    CK -->|shuts down| CN[executor]

    CJ -->|iterates| CO[Future<Boolean>]
    CO -->|checks| CP[Boolean]
    CO -->|logs| CQ[logger]
    CO -->|logs| CR[logger]

    CJ -->|logs| CS[logger]
    CJ -->|logs| CT[logger]

    CK -->|allows core thread timeout| CU[true]

    CK -->|submits| CV[ArchiveManifest]

    CK -->|logs| CW[logger]

    AV -->|has| CX[String]
    AV -->|has| CY[String]
    AV -->|has| CZ[String]
    AV -->|has| DA[String]

    AV -->|has| DB[String]
    AV -->|has| DC[String]
    AV -->|has| DD[String]

    AV -->|has| DE[String]
    AV -->|has| DF[File]
    AV -->|has| DG[File]
    AV -->|has| DH[String]
    AV -->|has| DI[String]
    AV -->|has| DJ[String]
    AV -->|has| DK[File]
    AV -->|has| DL[String]

    AV -->|has| DM[String]
    AV -->|has| DN[String]
    AV -->|has| DO[File]
    AV -->|has| DP[String]
    AV -->|has| DQ[String]
    AV -->|has| DR[String]

    AV -->|has| DS[String]
    AV -->|has| DT[String]
    AV -->|has| DU[String]
    AV -->|has| DV[String]
    AV -->|has| DW[String]
    AV -->|has| DX[String]
    AV -->|has| DY[String]
    AV -->|has| DZ[String]

    AV -->|has| EA[String]
    AV -->|has| EB[String]
    AV -->|has| EC[String]
    AV -->|has| ED[String]
    AV -->|has| EE[String]
    AV -->|has| EF[String]
    AV -->|has| EG[String]
    AV -->|has| EH[String]
    AV -->|has| EI[String]
    AV -->|has| EJ[String]
    AV -->|has| EK[String]
    AV -->|has| EL[String]
    AV -->|has| EM[String]
    AV -->|has| EN[String]
    AV -->|has| EO[String]
    AV -->|has| EP[String]
    AV -->|has| EQ[String]
    AV -->|has| ER[String]
    AV -->|has| ES[String]
    AV -->|has| ET[String]
    AV -->|has| EU[String]
    AV -->|has| EV[String]
    AV -->|has| EW[String]
    AV -->|has| EX[String]
    AV -->|has| EY[String]
    AV -->|has| EZ[String]
    AV -->|has| FA[String]
    AV -->|has| FB[String]
    AV -->|has| FC[String]
    AV -->|has| FD[String]
    AV -->|has| FE[String]
    AV -->|has| FF[String]
    AV -->|has| FG[String]
    AV -->|has| FH[String]
    AV -->|has| FI[String]
    AV -->|has| FJ[String]
    AV -->|has| FK[String]
    AV -->|has| FL[String]
    AV -->|has| FM[String]
    AV -->|has| FN[String]
    AV -->|has| FO[String]
    AV -->|has| FP[String]
    AV -->|has| FQ[String]
    AV -->|has| FR[String]
    AV -->|has| FS[String]
    AV -->|has| FT[String]
    AV -->|has| FU[String]
    AV -->|has| FV[String]
    AV -->|has| FW[String]
    AV -->|has| FX[String]
    AV -->|has| FY[String]
    AV -->|has| FZ[String]
    AV -->|has| GA[String]
    AV -->|has| GB[String]
    AV -->|has| GC[String]
    AV -->|has| GD[String]
    AV -->|has| GE[String]
    AV -->|has| GF[String]
    AV -->|has| GG[String]
    AV -->|has| GH[String]
    AV -->|has| GI[String]
    AV -->|has| GJ[String]
    AV -->|has| GK[String]
    AV -->|has| GL[String]
    AV -->|has| GM[String]
    AV -->|has| GN[String]
    AV -->|has| GO[String]
    AV -->|has| GP[String]
    AV -->|has| GQ[String]
    AV -->|has| GR[String]
    AV -->|has| GS[String]
    AV -->|has| GT[String]
    AV -->|has| GU[String]
    AV -->|has| GV[String]
    AV -->|has| GW[String]
    AV -->|has| GX[String]
    AV -->|has| GY[String]
    AV -->|has| GZ[String]
    AV -->|has| HA[String]
    AV -->|has| HB[String]
    AV -->|has| HC[String]
    AV -->|has| HD[String]
    AV -->|has| HE[String]
    AV -->|has| HF[String]
    AV -->|has| HG[String]
    AV -->|has| HH[String]
    AV -->|has| HI[String]
    AV -->|has| HJ[String]
    AV -->|has| HK[String]
    AV -->|has| HL[String]
    AV -->|has| HM[String]
    AV -->|has| HN[String]
    AV -->|has| HO[String]
    AV -->|has| HP[String]
    AV -->|has| HQ[String]
    AV -->|has| HR[String]
    AV -->|has| HS[String]
    AV -->|has| HT[String]
    AV -->|has| HU[String]
    AV -->|has| HV[String]
    AV -->|has| HW[String]
    AV -->|has| HX[String]
    AV -->|has| HY[String]
    AV -->|has| HZ[String]
    AV -->|has| IA[String]
    AV -->|has| IB[String]
    AV -->|has| IC[String]
    AV -->|has| ID[String]
    AV -->|has| IE[String]
    AV -->|has| IF[String]
    AV -->|has| IG[String]
    AV -->|has| IH[String]
    AV -->|has| II[String]
    AV -->|has| IJ[String]
    AV -->|has| IK[String]
    AV -->|has| IL[String]
    AV -->|has| IM[String]
    AV -->|has| IN[String]
    AV -->|has| IO[String]
    AV -->|has| IP[String]
    AV -->|has| IQ[String]
    AV -->|has| IR[String]
    AV -->|has| IS[String]
    AV -->|has| IT[String]
    AV -->|has| IU[String]
    AV -->|has| IV[String]
    AV -->|has| IW[String]
    AV -->|has| IX[String]
    AV -->|has| IY[String]
    AV -->|has| IZ[String]
    AV -->|has| JA[String]
    AV -->|has| JB[String]
    AV -->|has| JC[String]
    AV -->|has| JD[String]
    AV -->|has| JE[String]
    AV -->|has| JF[String]
    AV -->|has| JG[String]
    AV -->|has| JH[String]
    AV -->|has| JI[String]
    AV -->|has| JJ[String]
    AV -->|has| JK[String]
    AV -->|has| JL[String]
    AV -->|has| JM[String]
    AV -->|has| JN[String]
    AV -->|has| JO[String]
    AV -->|has| JP[String]
    AV -->|has| JQ[String]
    AV -->|has| JR[String]
    AV -->|has| JS[String]
    AV -->|has| JT[String]
    AV -->|has| JU[String]
    AV -->|has| JV[String]
    AV -->|has| JW[String]
    AV -->|has| JX[String]
    AV -->|has| JY[String]
    AV -->|has| JZ[String]
    AV -->|has| KA[String]
    AV -->|has| KB[String]
    AV -->|has| KC[String]
    AV -->|has| KD[String]
    AV -->|has| KE[String]
    AV -->|has| KF[String]
    AV -->|has| KG[String]
    AV -->|has| KH[String]
    AV -->|has| KI[String]
    AV -->|has| KJ[String]
    AV -->|has| KK[String]
    AV -->|has| KL[String]
    AV -->|has| KM[String]
    AV -->|has| KN[String]
    AV -->|has| KO[String]
    AV -->|has| KP[String]
    AV -->|has| KQ[String]
    AV -->|has| KR[String]
    AV -->|has| KS[String]
    AV -->|has| KT[String]
    AV -->|has| KU[String]
    AV -->|has| KV[String]
    AV -->|has| KW[String]
    AV -->|has| KX[String]
    AV -->|has| KY[String]
    AV -->|has| KZ[String]
    AV -->|has| LA[String]
    AV -->|has| LB[String]
    AV -->|has| LC[String]
    AV -->|has| LD[String]
    AV -->|has| LE[String]
    AV -->|has| LF[String]
    AV -->|has| LG[String]
    AV -->|has| LH[String]
    AV -->|has| LI[String]
    AV -->|has| LJ[String]
    AV -->|has| LK[String]
    AV -->|has| LL[String]
    AV -->|has| LM[String]
    AV -->|has| LN[String]
    AV -->|has| LO[String]
    AV -->|has| LP[String]
    AV -->|has| LQ[String]
    AV -->|has| LR[String]
    AV -->|has| LS[String]
    AV -->|has| LT[String]
    AV -->|has| LU[String]
    AV -->|has| LV[String]
    AV -->|has| LW[String]
    AV -->|has| LX[String]
    AV -->|has| LY[String]
    AV -->|has| LZ[String]
    AV -->|has| MA[String]
    AV -->|has| MB[String]
    AV -->|has| MC[String]
    AV -->|has| MD[String]
    AV -->|has| ME[String]
    AV -->|has| MF[String]
    AV -->|has| MG[String]
    AV -->|has| MH[String]
    AV -->|has| MI[String]
    AV -->|has| MJ[String]
    AV -->|has| MK[String]
    AV -->|has| ML[String]
    AV -->|has| MM[String]
    AV -->|has| MN[String]
    AV -->|has| MO[String]
    AV -->|has| MP[String]
    AV -->|has| MQ[String]
    AV -->|has| MR[String]
    AV -->|has| MS[String]
    AV -->|has| MT[String]
    AV -->|has| MU[String]
    AV -->|has| MV[String]
    AV -->|has| MW[String]
    AV -->|has| MX[String]
    AV -->|has| MY[String]
    AV -->|has| MZ[String]
    AV -->|has| NA[String]
    AV -->|has| NB[String]
    AV -->|has| NC[String]
    AV -->|has| ND[String]
    AV -->|has| NE[String]
    AV -->|has| NF[String]
    AV -->|has| NG[String]
    AV -->|has| NH[String]
    AV -->|has| NI[String]
    AV -->|has| NJ[String]
    AV -->|has| NK[String]
    AV -->|has| NL[String]
    AV -->|has| NM[String]
    AV -->|has| NN[String]
    AV -->|has| NO[String]
    AV -->|has| NP[String]
    AV -->|has| NQ[String]
    AV -->|has| NR[String]
    AV -->|has| NS[String]
    AV -->|has| NT[String]
    AV -->|has| NU[String]
    AV -->|has| NV[String]
    AV -->|has| NW[String]
    AV -->|has| NX[String]
    AV -->|has| NY[String]
    AV -->|has| NZ[String]
    AV -->|has| OA[String]
    AV -->|has| OB[String]
    AV -->|has| OC[String]
    AV -->|has| OD[String]
    AV -->|has| OE[String]
    AV -->|has| OF[String]
    AV -->|has| OG[String]
    AV -->|has| OH[String]
    AV -->|has| OI[String]
    AV -->|has| OJ[String]
    AV -->|has| OK[String]
    AV -->|has| OL[String]
    AV -->|has| OM[String]
    AV -->|has| ON[String]
    AV -->|has| OO[String]
    AV -->|has| OP[String]
    AV -->|has| OQ[String]
    AV -->|has| OR[String]
    AV -->|has| OS[String]
    AV -->|has| OT[String]
    AV -->|has| OU[String]
    AV -->|has| OV[String]
    AV -->|has| OW[String]
    AV -->|has| OX[String]
    AV -->|has| OY[String]
    AV -->|has| OZ[String]
    AV -->|has| PA[String]
    AV
```
